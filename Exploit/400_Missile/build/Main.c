/*
 * Main.c
 *
 *  Created on: 2016. 10. 25.
 *      Author: jeongyoungmin
 */
#include "Global.h"
#include "Function.h"
#include "Missile.h"
#include "Weapon.h"
#include "Operator.h"
#include "Admin.h"


int FuncAddrCheck(){
	int i;
	for(i = 0;i <= 3;i++){
		if(menu[i]->FuncPtr > 0x480000){
			exit(0);
		} 
	}
}

int main(void){
	char number[2];
	void* functionsAddr[MAXFUNC-1] = {WeaponManagement, MissileManagement, OperatorManagement, FunctionSetting};
	
	signal(SIGALRM, AlarmHandle);
	OTP();
	FuncDefSetting(functionsAddr);

	while(1){
		alarm(SIGALARMTIME);
		FunctionList();
		FuncAddrCheck();
		printf("Command : ");
		fflush(0);
		if(UserInput(number, 2)){
			switch(atoi(number)){
				case 1:
					//Weapon management
					if(menu[0]->state != 0)
						menu[0]->FuncPtr();
					break;
				case 2:
					//Missile management
					if(menu[1]->state != 0)
						menu[1]->FuncPtr();
					break;
				case 3:
					//Operator management
					if(menu[2]->state != 0)
						menu[2]->FuncPtr();
					break;
				case 4:
					//Function Setting
					if(menu[3]->state != 0)
						menu[3]->FuncPtr();
					//FunctionSetting();
					break;
				case 5:
					exit(1);
					break;
				default:
					break;
			}
		}
	}
	return 0;
}

#include "Global.h"
#include "Missile.h"

void MissileList(){
	unsigned int cnt;
	for(cnt = 0;cnt < state->missileCnt;cnt++){
		if(missile[cnt]->state != 0){
			printf("Missile Number\t: %d\n",cnt);
			printf("Missile Name\t: %s\n",missile[cnt]->name);
			printf("Missile storage location\t: %s\n",missile[cnt]->location);
			printf("\n");
		}
	}
}

void MissileAdd(){
	unsigned int cnt;
	unsigned int len;
	unsigned int size;
	char number[2];

	if(OperatorCheck()){
		if(state->missileCnt != 0){
			for(cnt = 0;cnt < state->missileCnt; cnt++){
				if(missile[cnt]->state == 0){
					//printf(">> %d Yes!!!\n", cnt);
					break;
				}
			}
		}else{
			cnt = 0;
		}

		if(cnt < MAXCNT){
			missile[cnt] = (Missile*)malloc(sizeof(Missile));
			missile[cnt]->state = 1;

			while(1){
				printf("Add Operator number : ");
				UserInput(number, 2);
				
				cnt = atoi(number);
				if(cnt < state->operatorCnt){
					if(operator[cnt]->state != 0){
						missile[cnt]->operator = operator[cnt]->part;
						break;
					}else{
						printf("Fail : Is not activated.\n");
					}
				}else{
					printf("0 ~ %d\n",state->operatorCnt - 1);
				}
			}

			printf("Missile Name : ");
			UserInput(missile[cnt]->name, STRLEN);

			printf("Missile storage location : ");
			UserInput(missile[cnt]->location, 35);

			if(cnt == state->missileCnt){
				if(state->missileCnt != MAXCNT){
					state->missileCnt++;
				}
			}

		}else{
			printf("Full\n");
		}
	}else{
		printf("Operator Add!\n");
	}
}

void MissileModification(){
	char number[3];
	unsigned int cnt;
	unsigned int size;
	unsigned int len;

	printf("Missile Number : ");
	UserInput(number, 2);

	cnt = atoi(number);
	if(cnt < state->missileCnt){
		if(missile[cnt]->state != 0){
			printf("Missile Number\t: %d\n",cnt);
			printf("Missile Name\t: %s\n",missile[cnt]->name);
			printf("Missile storage location \t: %s\n\n",missile[cnt]->location);

			size = sizeof(missile[cnt]->name) - 1;
			
			memset(missile[cnt]->name,0,size);
			memset(missile[cnt]->location,0,size);
			
			printf("Missile Name : ");
			UserInput(missile[cnt]->name, STRLEN);			

			printf("Missile storage location : ");
			UserInput(missile[cnt]->location, 33);
		}
	}else{
		printf("Input 0 ~ %d\n",state->missileCnt - 1);
	}
}

void MissileDelete(){
	char number[3];
	unsigned int cnt;

	printf("Missile Number : ");
	UserInput(number, 2);

	cnt = atoi(number);
	if(cnt < state->missileCnt){
		if(missile[cnt]->state != 0){
			missile[cnt]->state = 0;
			free(missile[cnt]);
		}else{
			printf("Fail!\n");
		}
	}else{
		printf("Fail!\n");
	}
}

void MissileManagement()
{
	char number[2];
	unsigned int control = 1;

	char missileFuncName[MAXFUNC][STRLEN] = {"Missile List", "Missile Add","Missile Mod","Missile Del","Exit"};

	printf("Missile Management\n");
	while(control){
		alarm(SIGALARMTIME);
		int cnt;
		for(cnt =0;cnt < MAXFUNC;cnt++){
			printf("%d) %s\n",cnt+1,missileFuncName[cnt]);
		}

		printf("Command : ");
		if(UserInput(number, 2)){
			switch(atoi(number)){
				case 1:
					//List
					MissileList();
					break;
				case 2:
					//Add
					MissileAdd();
					break;
				case 3:
					//Mod
					MissileModification();
					break;
				case 4:
					//Del
					MissileDelete();
					break;
				case 5:
					control = 0;
					break;
				default:
					break;
			}
		}
	}
}
